 # 閭欢鍙戦€佸姪鎵?PRD锛堥潰鍚戣揪浜虹鐞嗙郴缁熼泦鎴愶級

 ## 姒傝堪
 - 鐩爣锛氭彁渚涚ǔ瀹氥€佸畨鍏ㄣ€佸彲鎵╁睍鐨勯偖浠跺彂閫佹湇鍔★紝鏀寔澶氭ā鏉裤€佸璇█銆侀檮浠朵笌鍥剧墖銆佹寜娲诲姩/鎵规绠＄悊銆佷綔涓氬寲璋冨害涓庡彲瑙傛祴锛屽彲閫氳繃 API 闆嗘垚鍒拌揪浜虹鐞嗙郴缁熴€? - 鑼冨洿锛氶鏈熸敮鎸?Gmail 鍙戦€侊紙gmail.send 鏈€灏忔潈闄愶級锛岀幇鏈夊姛鑳?API 鍖栦笌浣滀笟鍖栵紱鍚庣画杩唬妯℃澘/闄勪欢绠＄悊銆佸绉熸埛涓庨檺娴併€佹寚鏍囦笌鍚堣銆?
 ## 瑙掕壊涓庡満鏅? - 闆嗘垚绯荤粺锛堣揪浜虹鐞嗭級锛氬垱寤?閫夋嫨妯℃澘銆佹彁浜ゅ彂閫佷綔涓氥€佹煡璇?鎺у埗銆佹帴鏀跺洖璋冦€? - 杩愯惀浜哄憳锛氶厤缃ā鏉裤€侀€夋嫨鍒嗙兢銆佽Е鍙戞椿鍔ㄥ彂閫併€佹煡鐪嬫姤鍛娿€? - 骞冲彴绠＄悊鍛橈細绠＄悊鍙戜欢浜鸿处鍙锋巿鏉冦€侀壌鏉冧笌閰嶉銆佺洃鎺т笌瀹¤銆?
 鍏稿瀷娴佺▼锛氱粦瀹氬彂浠朵汉 鈫?鍑嗗妯℃澘/闄勪欢 鈫?鎻愪氦浣滀笟锛堟椂闂?闄愰€?骞跺彂锛夆啋 璺熻釜杩涘害 鈫?鍥炶皟/鎶ュ憡銆?
 ## 鍔熻兘闇€姹? - 鍙戜欢浜轰笌璁よ瘉
   - 澶氬彂浠朵汉 Gmail 璐﹀彿缁戝畾锛圤Auth Web 鎺堟潈锛屾渶灏忔潈闄?gmail.send锛夈€?   - 瀹夊叏瀛樺偍 refresh token锛涜繍琛屾椂闈欓粯鍒锋柊 access token銆?   - 鍏煎鏈湴妗岄潰鎺堟潈锛堝紑鍙戞ā寮忥級锛屾湇鍔＄榛樿 Web 鎺堟潈銆? - 鏀朵欢浜轰笌鏁版嵁
   - API 鐩存帴浼犲叆鏀朵欢浜烘竻鍗曚笌涓€у寲瀛楁锛圝SON锛夛紝鏀寔澶栭儴 ID銆?   - 鍏煎 Excel锛堣縼绉绘湡锛夛紝鎻愪緵鏍￠獙/棰勮鎺ュ彛銆?   - 骞傜瓑锛氭敮鎸佹寜 campaign_id + recipient_id 鍘婚噸锛堝悗缁級銆? - 妯℃澘绠＄悊锛圡2锛?   - 妯℃澘 CRUD銆佺増鏈€佸惎鍋溿€?   - 鍗犱綅绗︽牎楠屻€侀粯璁ゅ€笺€佽瑷€鍥為€€锛汬TML 娓呮礂鐧藉悕鍗曘€? - 鍙戦€佷笌璋冨害
   - 涓ゆā寮忥細妯℃澘妯″紡銆佷紶缁熻嚜瀹氫箟涓婚/姝ｆ枃妯″紡銆?   - 浣滀笟鍖栵細鎻愪氦浣滀笟杩斿洖 job_id锛涙煡璇?鏆傚仠/鎭㈠/鍙栨秷銆?   - 璁″垝涓庤妭娴侊細寮€濮嬫椂闂淬€侀潤榛樻椂娈点€佹椂鍖恒€侀殢鏈洪棿闅斻€佸苟鍙戝害銆佸彂浠朵汉涓庡叏灞€闄愰€熴€?   - 闄勪欢涓庡浘鐗囷細闄勪欢鍙€夛紙鎬诲ぇ灏?鈮?25MB锛夛紝鍐呰仈鍥剧墖鑷姩澶勭悊銆?   - 閲嶈瘯锛氬彲閰嶇疆娆℃暟涓庢寚鏁伴€€閬匡紱鎸夐敊璇被鍨嬪尯鍒嗭紙4xx/5xx/閰嶉锛夈€? - 鍥炶皟涓庣粺璁?   - webhook 鍥炶皟锛氫綔涓氬紑濮嬨€佽繘搴︼紙鑱氬悎锛夈€佸畬鎴愩€佸け璐ャ€?   - 缁熻锛氭€绘暟/鎴愬姛/澶辫触/閲嶈瘯銆佽€楁椂銆佸钩鍧囬棿闅斻€佽瑷€鍒嗗竷銆侀敊璇垎甯冦€? - 瀹夊叏涓庢潈闄?   - API Key 閴存潈锛堥鏈燂級锛屽悗缁彲鍗囩骇 OAuth2/JWT 涓?RBAC銆?   - 浠ょ墝鍔犲瘑瀛樺偍锛涘瘑閽ユ潵鑷幆澧?瀵嗛挜绠＄悊锛涙渶灏忔潈闄愬師鍒欍€?   - 闄愭祦锛氬叏灞€ + 鍙戜欢浜?绉熸埛缁村害銆? - 鍚堣锛堝彲閫夛級
   - 閫€璁笌鎶戝埗鍚嶅崟锛涘悎瑙勫璁′笌鏃ュ織銆?
 ## 闈炲姛鑳介渶姹? - 鍙娴嬫€э細缁撴瀯鍖栨棩蹇楋紙鍚?job_id/sender锛夈€佹寚鏍囧鍑恒€侀敊璇爜瑙勮寖銆? - 鎬ц兘涓庢墿灞曪細绾跨▼姹犲苟鍙戯紱鍚庣画鍙紩鍏ラ槦鍒?浠诲姟绯荤粺锛涙枃浠跺瓨鍌ㄦ娊璞★紙鏈湴/瀵硅薄瀛樺偍锛夈€? - 鍙繍缁达細鐜鍖栭厤缃€丏ocker銆佸垎鐜锛坉ev/stage/prod锛夈€丱penAPI 鏂囨。銆?
 ## API 璁捐锛堥鐗堣鐐癸級
 - 鍋ュ悍锛欸ET `/api/health`
 - 鍙戜欢浜烘巿鏉?   - GET `/oauth/google/authorize?sender_email=...`
   - GET `/oauth/google/callback?code=...&state=...`
   - POST `/api/authenticate`锛堜繚鐣欙紝鐢ㄤ簬妫€鏌ョ姸鎬?瑙﹀彂鍒锋柊锛? - 鍙戦€佷綔涓?   - 浼犵粺锛歅OST `/api/send_emails`锛堝惈 `attachments` 鍙€夛級銆?   - 妯℃澘锛歅OST `/api/send_template_emails`锛堝惈 `attachments` 鍙€夛級銆?   - 鐘舵€侊細GET `/api/status?job_id=...`锛堥鐗堝彲淇濈暀鍏ㄥ眬锛屼絾鍝嶅簲鍖呭惈 job_id锛夈€?   - 鎺у埗锛歅OST `/api/pause|resume|stop`锛堝悗缁縼绉讳负 `/api/jobs/{job_id}/...`锛夈€? - 妯℃澘涓庨檮浠讹紙M2锛?   - POST/GET/PUT/DELETE `/api/templates`锛汸OST `/api/templates/validate`銆?   - POST `/api/attachments`锛堜笂浼狅級锛孏ET `/api/attachments/{id}`銆? - 棰勮涓庢牎楠?   - POST `/api/preview`锛汸OST `/api/preview_template_emails`锛?   - POST `/api/validate_excel`锛汸OST `/api/validate_templates`銆?
 ## 閿欒鐮佺害瀹氾紙绀轰緥锛? - AUTH_REQUIRED銆乀OKEN_EXPIRED銆丷ATE_LIMITED銆両NVALID_TEMPLATE銆丄TTACHMENT_INVALID銆丣OB_CONFLICT銆両NVALID_PARAMS銆丳ROVIDER_ERROR銆両NTERNAL_ERROR銆?
 ## 鏁版嵁妯″瀷锛堝缓璁級
 - SenderAccount(id, email, provider, tokens_ref, quota, tenant_id)
 - Template(id, name, language, subject, html, text, version, status)
 - Attachment(id, filename, mime, size, storage_uri, hash)
 - Job(id, type, sender_id, campaign_id, webhook_url, status, schedule, limits, created_at)
 - Message(id, job_id, to_email, language, variables, status, error_code, attempts, provider_msg_id)
 - Stats锛堣仛鍚堣鍥撅細job/campaign/sender/tenant锛?
 ## 閲岀▼纰戜笌楠屾敹
 - M1锛歐eb 鎺堟潈闂幆銆侀檮浠惰疮閫氥€佹ā鏉垮彂閫佹帴鏀?attachments銆佹棩蹇楀惈 job_id銆佹枃妗ｄ笌閿欒鐮併€丄PI Key 閴存潈銆? - M2锛氭ā鏉?闄勪欢绠＄悊銆佸绉熸埛涓庨檺娴併€佷綔涓氬寲 `/api/jobs/*`銆佸洖璋冧笌骞傜瓑銆? - M3锛氭寚鏍囧鍑轰笌澶辫触鏄庣粏銆侀€€璁紙鑻ョ撼鍏ワ級銆丏ocker 涓?OpenAPI銆?
 ## 鐜板瓨闂涓庝慨澶嶏紙M1 绔嬪嵆椤癸級
 - 浼犵粺妯″紡鏈疮閫?`attachments` 鑷冲疄闄呭彂閫佽矾寰勩€? - `/api/send_template_emails` 鏈帴鏀?`attachments`銆? - 鎺堟潈娴佺▼浠呮敮鎸佹闈㈡湰鍦版巿鏉冿紝缂哄皯鏈嶅姟绔?Web 鎺堟潈娴佺▼涓庡洖璋冭矾鐢便€?
 ## 渚濊禆涓庨厤缃紙棣栫増锛? - 鐜鍙橀噺锛?   - `AUTH_FLOW=web|desktop`
   - `GOOGLE_OAUTH_CLIENT_JSON=/path/client_secret.json`
   - `OAUTH_REDIRECT_URL=https://your-domain.com/oauth/google/callback`
   - `API_KEY=...`
   - `ENCRYPTION_KEY=...`

 ## 寰呮緞娓呴棶棰? - 鏄惁闇€瑕佹敮鎸侀潪 Gmail 鎻愪緵鍟嗭紵鐭湡鏄惁浠?Gmail锛?   - 鐭湡浠呮敮鎸丟mail

 - 鏄惁瀹屽叏閫氳繃 API 浼犲叆鏀朵欢浜烘暟鎹紵Excel 鏄惁淇濈暀锛?   - 鏂板API浼犲叆鏀朵欢浜烘暟鎹紝淇濈暀Excel

 - 鍥炶皟闇€姹傦細棰戠巼涓庣矑搴︼紙姣忓皝/鑱氬悎锛夛紝澶辫触閲嶈瘯绛栫暐锛?   - 鑱氬悎锛?
 - 澶氱鎴蜂笌閰嶉锛氭寜绉熸埛/鍙戜欢浜虹淮搴︾殑鍏蜂綋闄愬埗锛?   - 绠＄悊浜哄憳鍙互闄愬埗姣忎釜绉熸埛姣忓ぉ鍙互鍙戦€佸灏戞潯閭欢

 - 閫€璁?鎶戝埗鍚嶅崟鏄惁绾冲叆杩戞湡鑼冨洿锛?


- API Key 鍊间笌璇锋眰澶村悕锛堥粯璁?X-API-Key锛燂級
  - YOUR_STRIPE_API_KEY
- 閫熺巼闄愬埗锛堝 姣忓彂浠朵汉 20 req/min 鎴?姣忓垎閽熷彂閫侀槇鍊硷級
  - 涓嶅仛闄愬埗閫熺巼锛岃窡鐩墠鐨勯」鐩竴鏍凤紝鎸囧畾鐢ㄦ埛姣忓皝閭欢鐨勯棿闅旀椂闂?- state 绛惧悕瀵嗛挜涓庢槸鍚﹂渶瑕佷护鐗屽姞瀵嗭紙鑻ラ渶瑕侊紝鎴戜細鐢?ENCRYPTION_KEY锛?  - 涓嶉渶瑕?- 鏄惁闇€瑕?webhook锛堝洖璋?URL锛夊湪 M1 瀹炶锛岃繕鏄斁鍒?M2
  - 璇疯缁嗚鏄庤繖涓湁浠€涔堢敤
- 鏄惁鍚屾椂鐢熸垚 M2/M3 璁捐鏂囨。鑽夋
  - 涓嶉渶瑕?

# 使用草稿

草稿是指应用了 `DRAFT` 系统标签的未发送消息。 草稿中的消息一经创建便无法修改，但可以替换。从这个意义上讲，[草稿资源](https://developers.google.com/workspace/gmail/api/v1/reference/users/drafts?hl=zh-cn)只是一个容器，它提供稳定的 ID，因为底层消息 ID 会在每次替换消息时发生变化。

草稿中的[消息资源](https://developers.google.com/workspace/gmail/api/v1/reference/users/messages?hl=zh-cn)与其他消息的行为类似，但存在以下差异：

- 草稿邮件不能有除 `DRAFT` 系统标签以外的任何标签。
- 发送草稿后，系统会自动删除该草稿，并创建一个带有 `SENT` 系统标签的新邮件，其中包含更新后的 ID。此消息在 [`drafts.send`](https://developers.google.com/workspace/gmail/api/v1/reference/users/drafts/send?hl=zh-cn) 响应中返回。

## 创建邮件草稿

您的应用可以使用 [drafts.create](https://developers.google.com/workspace/gmail/api/v1/reference/users/drafts/create?hl=zh-cn) 方法创建草稿。一般流程如下：

1. 创建符合 [RFC 2822](http://www.ietf.org/rfc/rfc2822.txt) 的 MIME 消息。
2. 将消息转换为 base64url 编码的字符串。
3. [创建草稿](https://developers.google.com/workspace/gmail/api/v1/reference/users/drafts/create?hl=zh-cn)，并将 `drafts.message.raw` 字段的值设置为编码后的字符串。

以下代码示例演示了此过程。

[Java](https://developers.google.com/workspace/gmail/api/guides/drafts?hl=zh-cn#java)[Python](https://developers.google.com/workspace/gmail/api/guides/drafts?hl=zh-cn#python)

gmail/snippet/send mail/create_draft.py

[在 GitHub 上查看](https://github.com/googleworkspace/python-samples/blob/main/gmail/snippet/send mail/create_draft.py)

```
import base64
from email.message import EmailMessage

import google.auth
from googleapiclient.discovery import build
from googleapiclient.errors import HttpError


def gmail_create_draft():
  """Create and insert a draft email.
   Print the returned draft's message and id.
   Returns: Draft object, including draft id and message meta data.

  Load pre-authorized user credentials from the environment.
  TODO(developer) - See https://developers.google.com/identity
  for guides on implementing OAuth2 for the application.
  """
  creds, _ = google.auth.default()

  try:
    # create gmail api client
    service = build("gmail", "v1", credentials=creds)

    message = EmailMessage()

    message.set_content("This is automated draft mail")

    message["To"] = "gduser1@workspacesamples.dev"
    message["From"] = "gduser2@workspacesamples.dev"
    message["Subject"] = "Automated draft"

    # encoded message
    encoded_message = base64.urlsafe_b64encode(message.as_bytes()).decode()

    create_message = {"message": {"raw": encoded_message}}
    # pylint: disable=E1101
    draft = (
        service.users()
        .drafts()
        .create(userId="me", body=create_message)
        .execute()
    )

    print(f'Draft id: {draft["id"]}\nDraft message: {draft["message"]}')

  except HttpError as error:
    print(f"An error occurred: {error}")
    draft = None

  return draft


if __name__ == "__main__":
  gmail_create_draft()
```

## 更新草稿

与创建草稿类似，如需更新草稿，您必须在请求正文中提供 `Draft` 资源，并将 `draft.message.raw` 字段设置为包含 MIME 消息的 base64url 编码字符串。由于无法更新消息，因此草稿中包含的消息会被销毁，并替换为更新请求中提供的新 MIME 消息。

您可以通过调用 [`drafts.get`](https://developers.google.com/workspace/gmail/api/v1/reference/users/drafts/get?hl=zh-cn) 并使用参数 `format=raw` 来检索草稿中包含的当前 MIME 消息。

如需了解详情，请参阅 [`drafts.update`](https://developers.google.com/workspace/gmail/api/v1/reference/users/drafts/update?hl=zh-cn)。

## 发送草稿

发送草稿时，您可以选择按原样发送消息，也可以发送更新后的消息。如果您要使用新消息更新草稿内容，请在 [`drafts.send`](https://developers.google.com/workspace/gmail/api/v1/reference/users/drafts/send?hl=zh-cn) 请求的正文中提供 `Draft` 资源；设置要发送的草稿的 `draft.id`；并将 `draft.message.raw` 字段设置为编码为 base64url 编码字符串的新 MIME 消息。如需了解详情，请参阅 [`drafts.send`](https://developers.google.com/workspace/gmail/api/v1/reference/users/drafts/send?hl=zh-cn)。
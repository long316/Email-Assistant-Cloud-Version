# 多语言模板功能使用说明

## 概述

邮件助手现在支持多语言模板和自定义内容功能，可以根据Excel数据中的语言设置和模板参数动态生成个性化邮件。

## 新增功能

### 1. 多语言支持
- 支持多种语言的邮件模板
- 自动根据Excel中的"语言"列选择对应模板
- 如果找不到对应语言模板，自动回退到英语模板

### 2. 模板参数化
- 主题和内容支持参数占位符 `[参数名]`
- 自动从Excel数据中提取对应列的值进行替换
- 智能验证模板参数与Excel列的兼容性

### 3. HTML自动转换
- HTML内容模板自动转换为纯文本内容
- 保持邮件的富文本和纯文本双重兼容性

## Excel文件格式要求

### 必需列
```
邮箱, 合作次数, 回复次数, 跟进次数, 跟进方式, 是否已邮箱建联, 语言
```

### 新增要求
1. **语言列**: 指定每封邮件使用的语言（如：English, Spanish）
2. **模板参数列**: 根据模板中的参数添加相应列（如：某条视频内容总结, 达人ID, 钩子）

### 示例数据
```
邮箱                  | 语言    | 某条视频内容总结        | 达人ID      | 钩子
test@example.com     | English | camping gear review    | OutdoorPro  | Great content!
test2@ejemplo.com    | Spanish | reseña de equipos      | CampingEs   | ¡Excelente!
```

## 模板文件格式

### 存放位置
所有模板文件存放在 `template/` 目录下

### 命名规则
- 主题模板: `{语言代码}-subject`
- HTML内容模板: `{语言代码}-html_content`

### 语言代码映射
- English → en
- Spanish → esp
- French → fr
- German → de
- Chinese → zh
- Japanese → ja

### 模板示例

**英语主题模板 (en-subject)**
```
Loved your [某条视频内容总结] video and a partnership idea!
```

**西语主题模板 (esp-subject)**
```
Me encantó tu video sobre [某条视频内容总结] y tengo una idea de colaboración!
```

**HTML内容模板 (en-html_content)**
```html
<p>Hi [达人ID],</p>
<p>[钩子]</p>
<p>I'm Erica, founder of Swipe Up US...</p>
```

## API接口更新

### 新增接口

1. **验证模板兼容性**
   ```
   POST /api/validate_templates
   Body: {"excel_file_path": "path/to/file.xlsx"}
   ```

2. **预览模板邮件**
   ```
   POST /api/preview_template_emails
   Body: {"excel_file_path": "path/to/file.xlsx", "max_previews": 3}
   ```

3. **发送模板邮件**
   ```
   POST /api/send_template_emails
   Body: {
     "sender_email": "your@gmail.com",
     "excel_file_path": "path/to/file.xlsx",
     "start_time": "2024-01-01T09:00:00",
     "min_interval": 30,
     "max_interval": 120
   }
   ```

## 使用流程

1. **准备Excel文件**
   - 添加"语言"列
   - 添加模板参数对应的列

2. **创建模板文件**
   - 在template/目录下创建对应语言的模板
   - 使用 `[参数名]` 格式添加占位符

3. **验证兼容性**
   - 使用API或命令行验证模板与Excel数据的兼容性

4. **预览邮件**
   - 生成前几封邮件的预览确认效果

5. **发送邮件**
   - 使用模板发送功能批量发送个性化邮件

## 错误处理

系统会自动检测和报告以下问题：
- 缺失的模板文件
- 不匹配的模板参数
- Excel文件格式错误
- 语言配置问题

所有错误都会记录到日志文件中，方便排查问题。

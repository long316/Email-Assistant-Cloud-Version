**概览**

- 当前方案满足“单域名 + 路径分流 + Docker + Caddy（仅 80/443 暴露，自动 HTTPS）”。
- 你要把本项目与另一个 API 一起挂到同一域名的不同路径下，整合只需对方按约定加入/替换 other_api 服务并更新 Caddy 的路由块即可。

**需要提供给对方的关键信息**

- 域名与路径前缀
  - 域名：请替换 Caddyfile 顶部的 your-domain.com
  - 本项目前缀：/video-analysis（后端已支持 ROOT_PATH）
  - 另一个 API 前缀（示例）：/other-api（可改你们实际前缀）
- 内部服务与端口
  - 本项目服务名：api，容器内端口：8000
  - 另一个 API 服务名（示例占位）：other_api，容器内端口：8080（你们需确认）
- 对外端口
  - 只有 caddy 暴露端口：80/443
  - 其他服务仅在内部网络中通信（可使用 expose 标注内部端口，非必需）

**Caddy 路由规则与要求**

- 文件：Caddyfile
- 路由块（已配置）：
  - /video-analysis -> 反向代理到 api:8000，使用 handle 保留前缀，并传递 X-Forwarded-Prefix: /video-analysis（本项目用 ROOT_PATH 适配文档与 OpenAPI）
  - /other-api -> 反向代理到 other_api:8080（使用 handle_path 去前缀，方便对方无需支持 root_path）
- 你们如需不同前缀或端口，只需在 Caddyfile 中调整对应 handle/handle_path 与上游地址。

**Compose 服务与网络约束**

- 文件：docker-compose.yml
- 服务清单：
  - api（本项目 FastAPI + Gunicorn，镜像源自根目录 Dockerfile）
  - worker（本项目 Celery Worker）
  - redis（任务队列/结果存储）
  - other_api（你们的 API：占位，需替换镜像与内部端口）
  - caddy（唯一对外暴露 80/443，挂载 Caddyfile）
- 仅 caddy 使用 ports；其余服务均无对外端口映射，走同一网络 web

**环境变量（必须/重要）**

- 文件：.env（与 docker-compose.yml 同目录）
- 必填：GEMINI_API_KEY、（如启用鉴权）API_KEYS
- 本项目子路径：ROOT_PATH=/video-analysis（已在 api 服务的 environment 中设置）
- Redis/Celery：Compose 已覆盖为 redis 容器；如你们用外部 Redis，请将 CELERY_BROKER_URL、CELERY_RESULT_BACKEND 指向外部，且可移除 redis 服务

**接口与验证路径（本项目）**

- 健康检查：https://<你的域名>/video-analysis/api/v1/health
- 文档：https://<你的域名>/video-analysis/docs
- 另一个 API 的对外路径：https://<你的域名>/other-api/...（按你们服务实际定义）

**对方整合指引（给另一个项目的 agent）**

- 在本项目根目录使用提供的 docker-compose.yml 与 Caddyfile
- 替换 docker-compose.yml 中 other_api 的镜像与内部端口；如有环境变量，按需增加 env_file 或 environment
- 在 Caddyfile 中确保 /other-api 的上游为 other_api:<内部端口>；必要时调整路径前缀
- 保持只有 caddy 暴露 80/443；其他服务不映射对外端口
- 若另一个 API 也希望保留路径前缀（而不是被去前缀）：将对应块由 handle_path 改为 handle，并让对方后端支持 root_path 或识别 X-Forwarded-Prefix